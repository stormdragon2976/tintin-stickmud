#EVENT {VARIABLE UPDATE GMCP_CLIENT_MEDIA_PLAY}
{
#if {!&{bgm}}
{
#variable {bgm} {true}
};
#local {tmp} {%1};
#if {{${tmp[name]}} != {$OLD_MUSIC} && {${tmp[type]}} == {music}}
{
PLAY_MUSIC ${tmp[volume]} ${tmp[name]};
#variable {OLD_MUSIC} {${tmp[name]}}
}
}

#ALIAS {^PLAY_MUSIC %d %2}
{
	#if {!&{MCMP[VOLUME]}}
	{
		#variable {MCMP[VOLUME]} {0}
	};
	#if {{$bgm} == {true}}
	{
			#if {{$musicSoundFilePID} != {false}}
			{
				#system {kill $musicSoundFilePID;echo "false" > .musicSoundFilePID};
				#variable {musicSoundFilePID} {false}
			};
#local {vol} {};
#format {vol} {%d} {%1 / 4 - 20};
			#script {bash -c 'if [[ -f "StickMUDSounds/sounds/%2" ]] ; then play -qV0 "StickMUDSounds/sounds/%2" repeat - gain ${MCMP[VOLUME]} gain ${vol} &> /dev/null&echo "$!" > .musicSoundFilePID;echo "#variable {musicSoundFilePID} {$(cat .musicSoundFilePID)}";else echo "false" > .musicSoundFilePID;echo "#variable {musicSoundFilePID} {$(cat .musicSoundFilePID)}";fi'}
	}
}
{9}

#ALIAS {^{nobgm|bgm}$}
{
	#if {{%0} == {bgm}}
	{
		#variable {bgm} {true};
		#showme {MUD music enabled.}
	};
	#else
	{
		#if {{$musicSoundFilePID} != {false}}
		{
			#system {kill $musicSoundFilePID;echo "false" >.musicSoundFilePID };
			#variable {musicSoundFilePID} {false}
		};
		#unvariable {bgm};
		#variable {OLD_MUSIC} {};
		#showme {MUD music disabled.}
	}
}
{9}


#VARIABLE         {OLD_MUSIC}  {}
#VARIABLE         {musicSoundFile}  {}
#VARIABLE         {musicSoundFilePID}  {false}
